load('data_all.mat');

% use_clustering is a boolean value that clusters the data set into num_clusters different
% clusters if true. Uses the original dataset if false
use_clustering = true;

% k indicates how many of the nearest neighbors one should extract in order
% to classify using the k-nearest-neighbors method
k = 7;

num_clusters = 64;
num_classes = 10;
dimensions = 28*28;

if use_clustering
    [data_set,data_labels] = cluster_data_set(num_clusters,num_classes,trainv,trainlab);
else
    data_set = trainv;
    data_labels = trainlab;
end

% k_nearest_neighbors returns the 1x10000 vector classified_test_lab that indicates
% which class each vector in testv got assigned
classified_testlab = k_nearest_neighbors(data_set,data_labels,testv,k);

% Creates the confusion matrix by comparing testlab against 
confusion_matrix = zeros(10);
for i = 1:num_test
    confusion_matrix(testlab(i)+1,classified_testlab(i)+1) = confusion_matrix(testlab(i)+1,classified_testlab(i)+1) + 1;
end

for i = 1:10
    for j = 1:10
        fprintf("%i\t", confusion_matrix(i,j));
    end
    fprintf("\n");
end
correct = 0;
for i = 1:10
    correct = correct + confusion_matrix(i,i);
end
fprintf("Correct classifications = %i out of 10 000\n", correct);